<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.dreamteam.hola.dao.BoardMapper">
    <sql id="boardColumns">

    </sql>

    <select id="findById" resultType="BoardDto">
        select b.title,
               m.nickname writer,
               b.content,
               b.reg_date,
               b.recruit_status,
               b.recruit_type,
               b.recruit_cnt,
               b.duration,
               b.progress_type,
               b.contact_type,
               b.contact,
               b.start_date
        from board b
        join member m on m.member_id = b.member_id
        where b.board_id = #{id} and m.member_id = #{memberId}
    </select>

    <select id="findAllByRecruitType" resultType="BoardDto">
        select board_id id,
               title,
               view_cnt,
               recruit_status,
               recruit_type,
               recruit_cnt,
               progress_type,
               duration,
               start_date
        from board
        where recruit_type = #{id}
    </select>

    <update id="updateBoardViewCnt">
        update
            board
        set view_cnt = view_cnt + 1
        where board_id = #{id}
    </update>

    <insert id="insertBoard" parameterType="BoardDto">
        insert into board (member_id, title, content, recruit_type, recruit_cnt, progress_type, duration, contact_type, contact,
        start_date)
        values (#{memberId}, #{title}, #{content}, #{recruitType}, #{recruitCnt},#{progressType}, #{duration}, #{contactType},
        #{contact}, #{startDate})
        <selectKey keyProperty="id" resultType="long" order="AFTER">
            SELECT LAST_INSERT_ID()
        </selectKey>
    </insert>

    <select id="findAllBySkillTypes" resultType="BoardDto">
        select distinct b.board_id id,
        title,
        view_cnt,
        recruit_status,
        recruit_type,
        recruit_cnt,
        duration,
        start_date,
        progress_type
        from board b
        join board_skill bs on b.board_id = bs.board_id
        join skill s on bs.skill_id = s.skill_id
        <if test="skillTypes != null">
            where
            <foreach collection="skillTypes" item="skill" separator="or">
                skill_type = #{skill}
            </foreach>
        </if>
    </select>

    <update id="updateRecruitStatus">
        update board
        set recruit_status=#{status}
        where board_id = #{id}
    </update>

    <update id="update" parameterType="BoardDto">
        update board
        set title        = #{board.title},
            content      = #{board.content},
            recruit_type = #{board.recruitType},
            recruit_cnt  = #{board.recruitCnt},
            duration     = #{board.duration},
            start_date   = #{board.startDate},
            progress_type = #{board.progress_type},
            contact_type = #{board.contactType},
            contact      = #{board.contact}
        where board_id = #{id}
    </update>

    <select id="selectAllBoard" resultType="boardDto">
        select board_id,title,view_cnt,reg_date
        from board;
    </select>
</mapper>